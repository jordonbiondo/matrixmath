<html lang="en">

  <!------------------------------------------------------------
  -- Head
  -------------------------------------------------------------->
  <head>
    <!-- links -->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.min.css" rel="stylesheet">

    <link href="/client/matrix.css" rel="stylesheet">


    <!-- scripts -->

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>

    <script>

     var defaultMatrixWidth = 3;
       var defaultMatrixHeight = 3;

       var socket;

       socket = io.connect();

       socket.on("matrixFill", function(data) {
	 $("#detValue").val((data.det) ? data.det : "Not possible");
	 fillMatrixTable("#rrefMatrix", data.rref);
	 if (data.inverse) {
	   fillMatrixTable("#inverseMatrix", data.inverse);
       } else {
	   spoofFillMatrix("#inverseMatrix", data.size.height, data.size.width);
       }

     });



     /**
      * Fill table with matrix
      */
     function fillMatrixTable(table, matrix) {
       $(table).empty();
       $.each(matrix.data, function(i, row) {
         tRow = $('<tr>', {
           class: 'matrixRow'
         });
         $.each(row, function(j, value) {

           tRow.append($('<td>', {
             text: (parseFloat(value)) ? (Math.round(parseFloat(value*1000)) / 1000) : value,
             class: 'matrixData'
           }));

         });
         $(table).append(tRow);
       });
     }

     /**
     * Fill output with empty data
     */
     function spoofFillMatrix(table, n, m) {
       fillMatrixTable(table, {
	 data: (function() {
	   var result = new Array(n);
	   for (var i = 0; i < n; i++) {
	     var row = new Array(m);
	     for (var j = 0; j < m; j++) {
	       row[j] = "?";
	     }
	     result[i] = row;
	   }
	   return result;
	 })()
       });
     }

     /**
      * Resize matrix input
      */
     function resizeMatrixInputTable(height, width) {
       $("#inputMatrix").empty();
       for (var i = 0; i < height; i++) {
         tRow = $('<tr>', { class: 'matrixRow' });
	 for (var j = 0; j < width; j++) {

           tRow.append($('<td>', {
	     class: 'matrixData',
	     html: $("<input>", {
	       class: "matrixInput form-control",
               type: "number"
             })
	   }));
	 }
	 $("#inputMatrix").append(tRow);
       }
       spoofFillMatrix("#rrefMatrix", height, width);
       spoofFillMatrix("#inverseMatrix", height, width);
     }

     /**
      * Try resizing input matrix
      */
     function tryResizeInput() {
       var n = parseInt($("#matrixHeightInput").val());
       var m = parseInt($("#matrixWidthInput").val());
       if ((!isNaN(n)) &&
	   (!isNaN(m)) &&
	   m > 0 &&
	   n > 0) {
	 resizeMatrixInputTable(n, m);
       } else {
	 console.log("error resizing");
       }
     }
     /**
      * Get input and send if OK
      */
     function trySendMatrix() {
       var data = [];
       var error = false;
       $("#inputMatrix tr").each(function() {
	 if (error) return false;
	 var thisRow = [];
	 var tableData = $(this).find('td input');
	 if (tableData.length > 0) {
	   tableData.each(function() {
	     var val = parseFloat($(this).val());
	     if (isNaN(val)) {
	       error = true;
	     } else {
	       thisRow.push(val);
	     }
	   });
	   data.push(thisRow);
	 }
       });

       if (!error) {
	 socket.emit("compute", {data: data});
       } else {
	 alert("bad input");
	 $('#').popover(options)
       }
     }

     $(document).ready(function() {
       resizeMatrixInputTable(defaultMatrixHeight, defaultMatrixWidth);
	 $("#sizeForm").submit(function() {
	   tryResizeInput();
	   return false;
       });
         $("#inputMatrixForm").submit(function() {
           trySendMatrix();
           return false;
       });

     });



    </script>
  </head>

  <!------------------------------------------------------------
  -- Body
  -------------------------------------------------------------->
  <body>
    <div id="allcontent">
    <div class="page-header">
      <h1>Matrix Analyser <small>Computes the RREF, inverse, and determinant of any n&times;m matrix</small></h1>
      
    </div>
    <div class="well ">    
      <div class="well shadow">
      <form id="sizeForm" class="form-inline">
        size:
        <input id="matrixHeightInput"
               class="matrixInput form-control"
               placeholder="3"
               type="number">
        &times;
        <input id="matrixWidthInput"
               class="matrixInput form-control "
               placeholder="3"
               type="number">
        <button type="submit"
                class=".btn btn btn-primary"
                id="matrixResize"> Resize</button>
      </form>
    </div>
    
    <div class="well table-responsive shadow">
      <table id="matrixFormatTable">
      <tr>
	<td class="grid-unit">
	<form id="inputMatrixForm">
          <p class="text-center">Input Data</p>
          <table class="matrixTable" id="inputMatrix">
          </table>
	  <button type="submit" hidden="true"/>
        </form>
      </td>
      
      <td class="grid-unit">
	<p class="text-center">RREF</p>
        <table class="matrixTable" id="rrefMatrix">
        </table>
      </td>
      
      <td class="grid-unit">
	<!-- feature 3 -->
	<p class="text-center">Inverse</p>
        <table class="matrixTable" id="inverseMatrix">
        </table>
      </td>
      
      <td class="grid-unit">
	<!-- feature 4 -->
	<p class="text-center">Determinant</p>
        <input class="form-control text-center"
               id="detValue"
               type="number"
               readonly="readonly"/>
      </td>
      
      <td class="grid-unit">
	<!-- feature 5 -->
	<div id="computeButtonDiv">
          <button id="computeButton" class="btn btn-primary" onclick="trySendMatrix()">Compute</button>
        </div>
      </td>
      </tr>
    </table>
    </div>
    </div>
    
    </div>
    <div id="footer">
      <div class="container">
        <p class= "muted credit"> Authors:
          <a href="http://www.github.com/jordonbiondo">Jordon Biondo</a>,
          <a href="https://github.com/barrebre">Brett Barret</a></p>
      </div>
    </div>
  </body>

</html>
